<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Art Studio: Critic, Prompt, & Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Set Firebase log level for debugging
        setLogLevel('error'); 
        
        // --- GLOBAL VARIABLES (Provided by Canvas Environment) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let auth, userId = null;

        if (firebaseConfig) {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            
            // Function to handle Firebase Authentication
            const initializeAuth = async () => {
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                    userId = auth.currentUser?.uid || crypto.randomUUID();
                    console.log("Firebase Auth Initialized. User ID:", userId);
                    document.querySelectorAll('.user-id').forEach(el => el.textContent = userId);
                } catch (error) {
                    console.error("Firebase authentication error:", error);
                }
            };
            initializeAuth();
        }

        /**
         * Converts a File object to a Base64 string for the Gemini API.
         * @param {File} file The file object to convert.
         * @returns {Promise<string>} The Base64 data string.
         */
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    // Extract only the Base64 data part (after the comma)
                    const base64Data = reader.result.split(',')[1];
                    resolve(base64Data);
                };
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        /**
         * Displays a temporary notification message on the screen.
         * @param {string} message The message to display.
         * @param {string} type Tailwind classes for color (e.g., 'bg-red-500').
         */
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `p-3 rounded-xl shadow-lg fixed top-4 right-4 z-50 transition-all duration-300 ${type}`;
            setTimeout(() => {
                notification.className = 'p-3 rounded-xl shadow-lg fixed top-4 right-4 z-50 transition-all duration-300 opacity-0 transform translate-y-[-10px]';
            }, 5000);
        }

        // Simple Markdown parser for displaying the result nicely
        const marked = {
            parse: (markdown) => {
                let html = markdown
                    .replace(/^### (.*$)/gim, '<h3 class="text-xl font-bold mt-4 mb-2 text-indigo-600">$1</h3>')
                    .replace(/^## (.*$)/gim, '<h2 class="text-2xl font-bold mt-6 mb-3 text-gray-800">$1</h2>')
                    .replace(/^# (.*$)/gim, '<h1 class="text-3xl font-extrabold mt-8 mb-4 text-indigo-700">$1</h1>')
                    .replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>')
                    .replace(/\*(.*)\*/gim, '<em>$1</em>')
                    .replace(/^- (.*$)/gim, '<li>$1</li>')
                    .replace(/\n\n/gim, '<p class="mt-2 mb-2">')
                    .replace(/\n/gim, '<br>');
                
                // Final cleanup for list items (simple approach)
                html = html.replace(/<li>.*<\/li>/s, (match) => `<ul class="list-disc list-inside ml-4 space-y-1">${match}</ul>`);
                return html;
            }
        };

        // Function to display image previews
        function handleFileSelect(event, previewId, labelId) {
            const file = event.target.files[0];
            const preview = document.getElementById(previewId);

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    document.getElementById(labelId).textContent = file.name;
                }
                reader.readAsDataURL(file);
            } else {
                preview.src = '';
                preview.classList.add('hidden');
                document.getElementById(labelId).textContent = 'Choose File';
            }
        }

        // --- UTILITY FUNCTIONS ---
        async function fetchWithRetry(url, payload) {
            const maxRetries = 5;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429) { // Rate limit exceeded
                        if (i < maxRetries - 1) {
                            const delay = Math.pow(2, i) * 1000 + (Math.random() * 1000); // Exponential backoff + jitter
                            // console.log(`Rate limit hit. Retrying in ${delay / 1000}s...`); // Suppressed for console clarity
                            await new Promise(resolve => setTimeout(resolve, delay));
                            continue;
                        } else {
                            throw new Error("API rate limit exceeded after multiple retries.");
                        }
                    }
                    if (!response.ok) {
                         throw new Error(`API call failed with status: ${response.status} ${response.statusText}`);
                    }
                    return response; // Success!
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    // For network errors, we still want to wait and retry
                    const delay = Math.pow(2, i) * 1000 + (Math.random() * 1000);
                    // console.warn(`Fetch error on attempt ${i + 1}: ${error.message}. Retrying...`); // Suppressed for console clarity
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        function copyToClipboard(elementId) {
            const textToCopy = document.getElementById(elementId).textContent;
            try {
                // Use document.execCommand('copy') for better iFrame compatibility
                const el = document.createElement('textarea');
                el.value = textToCopy;
                el.setAttribute('readonly', '');
                el.style.position = 'absolute';
                el.style.left = '-9999px';
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);
                showNotification("Prompt copied to clipboard!", "bg-green-500 text-white");
            } catch (err) {
                console.error('Could not copy text: ', err);
                showNotification("Failed to copy. Please copy manually.", "bg-red-500 text-white");
            }
        }
        
        // --- CORE LOGIC: IMAGE GENERATION (IMAGEN) ---
        async function generateImageFromPrompt(prompt) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${""}`;
            
            const payload = { 
                instances: { prompt: prompt }, 
                parameters: { "sampleCount": 1 } 
            };

            const imageLoadingIndicator = document.getElementById('loading-indicator-image');
            const imageResultDiv = document.getElementById('image-result');
            
            imageResultDiv.innerHTML = `<p class="text-gray-400 text-center mt-4">Waiting for high-resolution image...</p>`;
            imageLoadingIndicator.classList.remove('hidden');

            try {
                const response = await fetchWithRetry(apiUrl, payload);
                const result = await response.json();
                
                if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                    const base64Data = result.predictions[0].bytesBase64Encoded;
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    
                    imageResultDiv.innerHTML = `
                        <p class="text-gray-700 font-semibold mb-3">AI Generation Result:</p>
                        <img src="${imageUrl}" alt="AI Generated Image in Reference Style" class="w-full h-auto max-h-[400px] object-cover rounded-xl shadow-xl border-4 border-indigo-200" />
                    `;
                    showNotification("Image successfully generated!", "bg-indigo-500 text-white");
                } else {
                    imageResultDiv.innerHTML = `<p class="text-red-500 text-center">Image generation failed. No image data received.</p>`;
                }
            } catch (error) {
                console.error("Critical error during image generation:", error);
                imageResultDiv.innerHTML = `<p class="text-red-500 text-center">Error: Could not generate the image. ${error.message}</p>`;
            } finally {
                imageLoadingIndicator.classList.add('hidden');
            }
        }


        // --- CORE LOGIC: PROMPT GENERATION (Miró Style) ---
        document.getElementById('prompt-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const styleInput = document.getElementById('style-file');
            const promptResultDiv = document.getElementById('prompt-result');
            const loadingIndicator = document.getElementById('loading-indicator-prompt');
            const submitButton = document.getElementById('submit-button-prompt');
            
            promptResultDiv.innerHTML = '';
            document.getElementById('image-result').innerHTML = '<p class="text-gray-400 text-center">Generated image will appear here.</p>';
            loadingIndicator.classList.remove('hidden');
            submitButton.disabled = true;
            submitButton.textContent = 'Analyzing Style...';

            if (styleInput.files.length === 0) {
                loadingIndicator.classList.add('hidden');
                submitButton.disabled = false;
                submitButton.textContent = 'Generate Prompt and Image';
                showNotification("Please upload an image to analyze the style.", "bg-yellow-500 text-white");
                return;
            }

            try {
                const styleBase64 = await fileToBase64(styleInput.files[0]);
                
                // 1. GENERATE PROMPT (GEMINI)
                const geminiSystemPrompt = `You are a specialized AI Art Prompt Engineer. Your task is to analyze the user-provided image (Image 1) and output a highly detailed, single-paragraph text prompt specifically designed to be used with a sophisticated text-to-image generator (like Imagen or Midjourney).

The generated prompt MUST focus on replicating the following elements of the input image:
1.  **Art Style/Movement:** E.g., Surrealism, Abstract Expressionism, Digital Painting.
2.  **Key Elements/Subjects:** E.g., Biomorphic shapes, stick figures, floating objects, geometric structures.
3.  **Color Palette:** Use specific, descriptive colors, e.g., 'primary red, cobalt blue, ochre yellow, deep black outlines.'
4.  **Composition/Space:** E.g., Sparse negative space, dynamic verticality, flat depth, sense of movement.
5.  **Texture/Medium:** E.g., Thick impasto brushstrokes, airbrush finish, chalk on canvas, digital vector art.

The output MUST be a single, continuous paragraph, suitable for direct use in an image generation tool. Do NOT include headings or extra conversational text.`;

                const geminiUserQuery = `Analyze this image (Image 1) and generate the optimal text prompt to create a new, similar artwork in this style.`;

                const geminiPayload = {
                    contents: [
                        { 
                            role: "user", 
                            parts: [
                                { inlineData: { mimeType: styleInput.files[0].type, data: styleBase64 } },
                                { text: "Image 1: Style Reference" },
                                { text: geminiUserQuery }
                            ]
                        }
                    ],
                    systemInstruction: {
                        parts: [{ text: geminiSystemPrompt }]
                    }
                };

                const geminiApiKey = ""; 
                const geminiApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${geminiApiKey}`;
                
                const geminiResponse = await fetchWithRetry(geminiApiUrl, geminiPayload);
                const geminiResult = await geminiResponse.json();
                const geminiCandidate = geminiResult.candidates?.[0];

                let promptText = "Prompt generation failed. Could not proceed to image generation.";

                if (geminiCandidate && geminiCandidate.content?.parts?.[0]?.text) {
                    promptText = geminiCandidate.content.parts[0].text;
                    
                    promptResultDiv.innerHTML = `
                        <p class="mb-3 text-gray-700 font-semibold">Generated Prompt (Used for Image Generation):</p>
                        <div class="p-4 bg-white border border-indigo-200 rounded-lg shadow-inner text-sm overflow-x-auto relative">
                            <code id="generated-prompt-code" class="text-indigo-800">${promptText}</code>
                            <button onclick="copyToClipboard('generated-prompt-code')" class="absolute top-2 right-2 p-1 bg-indigo-100 hover:bg-indigo-300 rounded-md text-indigo-700 transition duration-150" aria-label="Copy prompt to clipboard">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5h4m-4 0V3m8 2V3m-4 8v8m0-8h4m-4 0h-4m4 4h4m-4 4h4" />
                                </svg>
                            </button>
                        </div>
                    `;

                    // 2. GENERATE IMAGE (IMAGEN)
                    await generateImageFromPrompt(promptText);

                } else {
                    promptResultDiv.innerHTML = `<p class="text-red-500">Error: Could not generate the text prompt. Check console for details.</p>`;
                }

            } catch (error) {
                console.error("Critical error during prompt generation:", error);
                showNotification(`A critical error occurred: ${error.message}`, "bg-red-600 text-white");
                promptResultDiv.innerHTML = `<p class="text-red-500">Error: The operation failed. Please check the console for details.</p>`;
            } finally {
                loadingIndicator.classList.add('hidden');
                submitButton.disabled = false;
                submitButton.textContent = 'Generate Prompt and Image';
            }
        });

        
        // --- CORE LOGIC: IMAGE ANALYSIS (Art Critic Engine) ---
        document.getElementById('analysis-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const masterpieceInput = document.getElementById('masterpiece-file');
            const aiArtInput = document.getElementById('ai-art-file');
            const resultDiv = document.getElementById('critic-result');
            const loadingIndicator = document.getElementById('loading-indicator-critic');
            const submitButton = document.getElementById('submit-button-critic');
            
            resultDiv.innerHTML = '';
            loadingIndicator.classList.remove('hidden');
            submitButton.disabled = true;
            submitButton.textContent = 'Analyzing...';

            if (masterpieceInput.files.length === 0 || aiArtInput.files.length === 0) {
                loadingIndicator.classList.add('hidden');
                submitButton.disabled = false;
                submitButton.textContent = 'Run Analysis';
                showNotification("Please upload both a Masterpiece and an AI Art image.", "bg-yellow-500 text-white");
                return;
            }

            try {
                const masterpieceBase64 = await fileToBase64(masterpieceInput.files[0]);
                const aiArtBase64 = await fileToBase64(aiArtInput.files[0]);
                
                const systemPrompt = `You are "The Art Engine," a world-renowned art historian and critic specializing in formal analysis and comparative studies of abstract and contemporary art. Your task is to perform a detailed, unbiased critique comparing a historical 'Masterpiece' (Image 1) with a modern 'AI Generation' (Image 2).

Format your response strictly into three sections:
1.  **MASTERPIECE ANALYSIS:** A concise summary of Image 1, focusing on historical context, composition, color palette, and emotional intent.
2.  **AI GENERATION ANALYSIS:** A concise critique of Image 2, focusing on its formal elements (texture, brushwork simulation, color usage) and how successfully it conveys a unique artistic vision.
3.  **COMPARATIVE CRITIQUE:** A formal comparison of both images. Assess how effectively the AI Generation utilizes or subverts the formal language of the Masterpiece. Conclude with a single sentence summarizing which work has greater emotional resonance and why.

Maintain a sophisticated, academic, yet accessible tone. Use precise art terminology (e.g., "chiaroscuro," "impasto," "color field," "negative space").`;

                const userQuery = `Critique the Masterpiece (Image 1) and the AI Generation (Image 2). Focus on the comparison of formal elements and abstract expression.`;

                const payload = {
                    contents: [
                        { 
                            role: "user", 
                            parts: [
                                { inlineData: { mimeType: masterpieceInput.files[0].type, data: masterpieceBase64 } },
                                { text: "Image 1: The Masterpiece (Human-created)" },
                                { inlineData: { mimeType: aiArtInput.files[0].type, data: aiArtBase64 } },
                                { text: "Image 2: The AI Generation (Machine-created)" },
                                { text: userQuery }
                            ]
                        }
                    ],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    }
                };

                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                
                const response = await fetchWithRetry(apiUrl, payload);
                const result = await response.json();
                const candidate = result.candidates?.[0];

                let criticismText = "Analysis failed: Could not retrieve generated text.";

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    criticismText = marked.parse(candidate.content.parts[0].text); 
                }

                resultDiv.innerHTML = criticismText;

            } catch (error) {
                console.error("Critical error during analysis:", error);
                showNotification(`An error occurred: ${error.message}`, "bg-red-600 text-white");
                resultDiv.innerHTML = `<p class="text-red-500">Error: The Art Engine could not complete the analysis. Please check the console for details.</p>`;
            } finally {
                loadingIndicator.classList.add('hidden');
                submitButton.disabled = false;
                submitButton.textContent = 'Run Analysis';
            }
        });


        // Attach listeners to file inputs when the window loads
        window.onload = () => {
             // Critic Engine Listeners
             document.getElementById('masterpiece-file').addEventListener('change', (e) => handleFileSelect(e, 'masterpiece-preview', 'masterpiece-preview-label'));
             document.getElementById('ai-art-file').addEventListener('change', (e) => handleFileSelect(e, 'ai-art-preview', 'ai-art-preview-label'));
             
             // Prompt Generator Listener
             document.getElementById('style-file').addEventListener('change', (e) => handleFileSelect(e, 'style-preview', 'style-preview-label'));
        };

    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        /* Custom file input styling */
        .custom-file-upload {
            border: 2px dashed #9ca3af;
            background-color: #f9fafb;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .custom-file-upload:hover {
            border-color: #4f46e5;
            background-color: #eef2ff;
        }
        .file-input-label {
            display: block;
            margin-top: 0.5rem;
            color: #4b5563;
            font-weight: 600;
        }
        .prose p {
            margin-bottom: 1em;
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-8">

    <!-- Notification Container -->
    <div id="notification" class="opacity-0 transform translate-y-[-10px]"></div>

    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-10 rounded-3xl shadow-2xl space-y-12">
        <header class="text-center">
            <h1 class="text-4xl font-extrabold text-indigo-700">AI Art Studio</h1>
            <p class="text-gray-500 mt-2">The complete tool for Style Analysis, Generation, and Criticism.</p>
            <p class="text-xs text-gray-400 mt-2">User ID: <span class="user-id font-mono">Loading...</span></p>
        </header>

        <!-- SECTION 1: Style Prompt Generator & Image Generator -->
        <section class="border-b pb-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-3 text-green-600">1. Style Analyzer & Image Generator</h2>
            <p class="text-gray-600 mb-6">Upload a reference image (e.g., Miró). Gemini analyzes the style, generates a prompt, and **Imagen 4.0** creates a new artwork in that style.</p>

            <form id="prompt-form">
                <div class="flex flex-col space-y-4 max-w-lg mx-auto">
                    <h3 class="text-xl font-semibold text-gray-700">Upload Style Reference Image</h3>
                    <label for="style-file" class="custom-file-upload rounded-xl">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <span id="style-preview-label" class="file-input-label">Choose File (e.g., Miró's work)</span>
                        <input type="file" id="style-file" accept="image/*" class="hidden" required>
                    </label>
                    <img id="style-preview" class="hidden w-full h-48 object-contain rounded-xl shadow-md border border-gray-200 bg-gray-100" alt="Style Reference Preview">
                </div>

                <div class="text-center mt-6">
                    <button type="submit" id="submit-button-prompt" class="px-8 py-3 bg-green-600 text-white font-bold rounded-full shadow-lg hover:bg-green-700 transition duration-300 transform hover:scale-105 disabled:bg-green-400">
                        Generate Prompt and Image
                    </button>
                </div>
            </form>

            <!-- Prompt Generation and Image Result -->
            <div class="mt-8 pt-6 border-t border-gray-200 grid lg:grid-cols-2 gap-8">
                <!-- Left Column: Generated Prompt -->
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Generated Prompt (Gemini Analysis)</h3>
                    <div id="loading-indicator-prompt" class="hidden text-center p-4">
                        <div class="animate-spin rounded-full h-8 w-8 border-4 border-indigo-500 border-t-transparent mx-auto"></div>
                        <p class="mt-2 text-gray-500 text-sm">Analyzing style components...</p>
                    </div>

                    <div id="prompt-result" class="p-4 bg-gray-50 rounded-xl border border-gray-100 min-h-[100px] flex items-center justify-center">
                        <p class="text-gray-400 text-center">The optimized image generation prompt will appear here.</p>
                    </div>
                </div>

                <!-- Right Column: Generated Image -->
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Generated Image (Imagen 4.0)</h3>
                    <div id="loading-indicator-image" class="hidden text-center p-4">
                        <div class="animate-spin rounded-full h-12 w-12 border-4 border-green-500 border-t-transparent mx-auto"></div>
                        <p class="mt-3 text-gray-500">Imagen is painting your new artwork...</p>
                    </div>
                    <div id="image-result" class="p-4 bg-gray-50 rounded-xl border border-gray-100 min-h-[200px] flex items-center justify-center">
                        <p class="text-gray-400 text-center">Generated image will appear here.</p>
                    </div>
                </div>
            </div>
        </section>


        <!-- SECTION 2: AI Art Critic Engine (Original Feature) -->
        <section class="pt-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-3 text-indigo-600">2. Art Critic Engine</h2>
            <p class="text-gray-600 mb-6">Compare a human masterpiece against an AI-generated piece with a formal, academic critique using Gemini.</p>

            <form id="analysis-form">
                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <!-- Image 1: Human Masterpiece -->
                    <div class="flex flex-col space-y-4">
                        <h3 class="text-xl font-semibold text-gray-700">1. Upload Human Masterpiece (Image 1)</h3>
                        <label for="masterpiece-file" class="custom-file-upload rounded-xl">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span id="masterpiece-preview-label" class="file-input-label">Choose File (e.g., a famous abstract painting)</span>
                            <input type="file" id="masterpiece-file" accept="image/*" class="hidden" required>
                        </label>
                        <img id="masterpiece-preview" class="hidden w-full h-48 object-cover rounded-xl shadow-md border border-gray-200" alt="Masterpiece Preview">
                    </div>

                    <!-- Image 2: AI Generation -->
                    <div class="flex flex-col space-y-4">
                        <h3 class="text-xl font-semibold text-gray-700">2. Upload AI Generated Art (Image 2)</h3>
                        <label for="ai-art-file" class="custom-file-upload rounded-xl">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l-4 4m0 0l-4-4m-4 4l4-4" />
                            </svg>
                            <span id="ai-art-preview-label" class="file-input-label">Choose File (e.g., your DALL-E or Midjourney creation)</span>
                            <input type="file" id="ai-art-file" accept="image/*" class="hidden" required>
                        </label>
                        <img id="ai-art-preview" class="hidden w-full h-48 object-cover rounded-xl shadow-md border border-gray-200" alt="AI Art Preview">
                    </div>
                </div>

                <div class="text-center">
                    <button type="submit" id="submit-button-critic" class="px-8 py-3 bg-indigo-600 text-white font-bold rounded-full shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-105 disabled:bg-indigo-400">
                        Run Analysis
                    </button>
                </div>
            </form>

            <!-- Analysis Result Section -->
            <div class="mt-12 pt-8 border-t border-gray-200">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Formal Critique Result</h3>
                
                <div id="loading-indicator-critic" class="hidden text-center p-6">
                    <div class="animate-spin rounded-full h-12 w-12 border-4 border-indigo-500 border-t-transparent mx-auto"></div>
                    <p class="mt-3 text-gray-500">The Art Engine is studying the works...</p>
                </div>

                <div id="critic-result" class="prose max-w-none p-6 bg-gray-50 rounded-xl border border-gray-100 min-h-[150px] space-y-4 text-gray-700">
                    <p class="text-gray-400">Upload two images and click "Run Analysis" to receive a professional art criticism.</p>
                </div>
            </div>
        </section>
    </div>
</body>
</html>
